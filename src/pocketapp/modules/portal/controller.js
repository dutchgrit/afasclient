angular.module("portal.controller",["AfasServices"]).controller("PortalController",["$scope","ConfigService","$ionicPopup","$ionicActionSheet","$interval","$state","LocalStorageService","question","$rootScope","$ionicHistory","$timeout",function(e,t,n,o,r,a,l,s,i,c,p){e.interval=null,e.totsecs=99,e.qrscanner=!1,e.nopocket=!1,e.progress={label:""},void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),p(function(){i.blocker&&(i.blocker.style.display="none")},10),e.refreshTemplates=function(){"undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins&&"undefined"!=typeof cordova.plugins.Aucoresdk&&cordova.plugins.Aucoresdk.getTemplates().then(function(t){if(e.result=t,e.totsecs=99,e.t0=Date.now(),t.templates&&0!=t.templates.length||l.removeItem("qrregs"),t.templates)for(var n=0;n<t.templates.length;n++){try{var o=t.templates[n].additional.split(";"),a=t.templates[n].additional;2==o.length&&(t.templates[n].email=o[0],a=o[1]),t.templates[n].adddate=new Date(parseInt(a,10))}catch(s){}e.totsecs=Math.min(t.templates[n].secs,e.totsecs),t.templates[n].progress={label:e.totsecs,percentage:(30-e.totsecs)/30}}e.startSecs=e.totsecs,null!=e.interval&&(r.cancel(e.interval),e.interval=null),e.interval=r(function(){var t=(Date.now()-e.t0)/1e3;e.totsecs=Math.ceil(Math.max(0,e.startSecs-t));for(var n=0;n<e.result.templates.length;n++){var o=e.totsecs,a=(30-e.totsecs)/30,l="#fbfbfb",s="#2c6cbf",i="#2c6cbf",c=3,p=20,d=document.getElementById("canvas"+n);if(null!=d){var f=d.getContext("2d"),u=height=70;f.clearRect(0,0,u,height);var h=u/2,v=height/2;f.beginPath(),f.arc(h,v,parseInt(p),0,2*Math.PI,!1),f.lineWidth=parseInt(c),f.strokeStyle=l,f.stroke(),f.font="18pt Calibri",f.textAlign="center",f.textBaseline="middle",f.fillStyle=i,f.fillText(o,h,v);var g=-(Math.PI/2),m=2*Math.PI*a-Math.PI/2,I=!1;f.beginPath(),f.arc(h,v,parseInt(p),g,m,I),f.lineWidth=parseInt(c),f.strokeStyle=s,f.stroke()}}e.totsecs<=0&&(r.cancel(e.interval),e.interval=null,e.refreshTemplates())},500)})},e.$on("$ionicView.enter",function(){l.getItem("push-token").then(function(t){isNotEmpty(t)&&(e.appPushToken=t)});var t=!1;l.getItem("token").then(function(e){isNotEmpty(e)&&(t=!0)})["finally"](function(){e.nopocket=!t}),e.refreshTemplates(),e.refreshInt=r(function(){"undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins.Aucoresdk&&cordova.plugins.Aucoresdk.refresh()},5e3),i.refreshInt=e.refreshInt}),e.deleteTemplate=function(t){s(atrans("deletetextqr","Weet je zeker dat je de koppeling wilt verwijderen?")).then(function(n){1==n&&"undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins.Aucoresdk&&cordova.plugins.Aucoresdk.deleteTemplate(t).then(function(){e.refreshTemplates()})})},e.doScan=function(){a.go("menu.qrscan",{},{reload:!0})},e.$on("$ionicView.leave",function(){null!=e.interval&&(r.cancel(e.interval),e.interval=null),e.refreshInt&&(r.cancel(e.refreshInt),e.refreshInt=null,i.refreshInt=null)})}]);