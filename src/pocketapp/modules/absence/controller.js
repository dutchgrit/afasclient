angular.module("absence.controller",["AfasServices"]).factory("SharedAbsenceService",["AbsenceServiceFactory",function(e){var t=e.getInstance();return{getAbsenceService:function(){return t}}}]).controller("AbsenceController",["$scope","$state","$timeout","$ionicActionSheet","$locale","SharedAbsenceService","ListServiceFactory","UserService","$stateParams","$templateCache","$ionicPopover","maxListTake","ConfigService","EnvConfigService","ModalSearchService","SearchService",function(e,t,o,n,r,a,i,l,f,c,d,s,m,u,h,v){function g(t){var o;e.multipledvb&&(o=e.form.dvbsel?e.form.dvbsel.employment:t.dvb),T.getSchedule(o).then(function(n){M=n[0].hours_per_week/n[0].days_per_week,(1==n[0].variable_work_pattern&&0==n[0].variable_with_schedule||0==M)&&(e.pageTitle=atrans("absenceoverview","Verlofoverzicht"),e.unit="hours"),T.getLeaveSaldo(t,o).then(function(t){p=(t.SaldoAfterMutation+t.Duration)/60,b=t.SaldoBeginPeriod/60,w=b-p,t.SaldoDaysBeforeMutation?(S=Math.round(10*t.SaldoDaysBeforeMutation)/10,D=Math.round(10*t.SaldoDaysBeginPeriod)/10,k=Math.round(10*(t.SaldoDaysBeginPeriod-t.SaldoDaysBeforeMutation))/10):(S=Math.round(p/8*10)/10,D=Math.round(b/8*10)/10,k=Math.round(w/8*10)/10),(isNaN(S)||0>S)&&(S=0),(isNaN(D)||0>D)&&(D=0),(isNaN(k)||0>k)&&(k=0),e.gageloaded=!0,"days"==e.unit?(e.balance_unit=atrans("days","dagen"),e.current=S,e.used=k,e.total=D):(e.balance_unit=atrans("hours","uur"),e.current=p,e.used=w,e.total=b)})})}function y(t){var o;e.multipledvb&&(o=e.form.dvbsel?e.form.dvbsel.employment:t.dvb),T.getAbsencesByUser(t,I,s,o).then(function(t){t=_.divideList(t,3,"start_datetime",2),e.absences=t,I=t.length,0==e.absences.length&&(e.noresults=!0)})}var p,b,w,S,D,k,M,T=a.getAbsenceService(),_=i.getInstance(),P={AbsenceService:T},I=0;e.pageTitle=atrans("leave","Verlof"),e.balance_unit=atrans("hours","uur"),e.gageloaded=!1,e.noresults=!1,e.hideBalance=!1,e.unit="hours",e.form={},e.$on("$ionicView.enter",function(){I=0,m.getConfig().then(function(t){l.getUser().then(function(o){e.multipledvb=o.multiple_employment&&isVersionOrHigher(t,"Profit6"),e.multipledvb&&T.getDvbs(e.form,!0).then(function(t){e.dvbs=t,e.multipledvbshow=t.length>1}),g(o),y(o)})})}),e.switchUnit=function(){0==e.hideBalance&&("hours"==e.unit?(e.unit="days",e.balance_unit=atrans("days","dagen"),e.current=S,e.used=k,e.total=D):(e.unit="hours",e.balance_unit=atrans("hours","uur"),e.current=p,e.used=w,e.total=b))},e.changeDvb=function(){l.getUser().then(function(t){SessionStorage.setItem("dvbsel",JSON.stringify(e.form.dvbsel)),g(t),y(t)})},e.GoToNewAbsence=function(){m.getConfig().then(function(r){function a(e){o(function(){if(document.body.lastChild&&document.body.lastChild.firstChild){var e=window.getComputedStyle(document.body.lastChild.firstChild);"matrix(1, 0, 0, 1, 0, 0)"!=e["-webkit-transform"]&&(document.body.lastChild.firstChild.style["-webkit-transform"]="matrix(1, 0, 0, 1, 0, 0)")}},500),n.show({buttons:e,titleText:atrans("newleave","Nieuw verlof"),cancelText:atrans("cancel","Annuleren"),cancel:function(){},buttonClicked:function(o){t.go("menu.newabsence",{leaveprofile:e[o].leaveProfile},{reload:!0})}})}isVersionOrHigher(r,"Profit10")?u.getEnvConfig().then(function(o){o.profileinfo[11]&&o.profileinfo[11]>0?o.profileinfo[11]>5?e.openModal():T.searchProfiles("",0,6,"leave").then(function(e){for(var t=[],o=0;o<e.length;o++)t.push({text:"<i class='icon iconHide'></i>"+e[o].Description,id:2,leaveProfile:e[o]});a(t)}):t.go("menu.newabsence",{},{reload:!1})}):t.go("menu.newabsence",{},{reload:!1})})},e.goToDetail=function(e,o,n){"DIVIDER"!=n&&t.go("menu.absencedetails",{subjectid:e,recordnumber:o},{reload:!0})},e.loadMoreAbsences=function(){l.getUser().then(function(t){if(!scope.loadingMore){e.loadingMore=!0,I+=s;var o;e.multipledvb&&(o=e.form.dvbsel?e.form.dvbsel.employment:t.dvb),T.getAbsencesByUser(t,I,s,o).then(function(t){e.showmore=t.length>=s;for(var o=0;o<t.length;o++)e.absences.push(t[o]);e.$broadcast("scroll.infiniteScrollComplete")})["finally"](function(){$ionicScrollDelegate.resize(),e.loadingMore=!1,e.$broadcast("scroll.refreshComplete")})}})},e.openModal=function(){h.openModal(e,"Pocket_LeaveProfiles",P)},e.closeModal=function(){e.modal.hide()},e.showhide=function(){e.hidden=!e.hidden},e.search=function(t){h.search(e,t,P)},e.loadMore=function(){h.loadMore(e,P)},e.clearSearch=function(t){h.clearSearch(e)},e.clickRecent=function(t){e.modal.query=t,h.search(e,t,P)},e.ShowRecentSearches=function(){h.ShowRecentSearches(e)},e.HideRecentSearches=function(){h.HideRecentSearches(e)},e.selectTab=function(t){e.modal&&!e.modal.loading&&(e.modal.showType=t)},e.selectLeaveType=function(o){v.setRecentlySelected(o,"recent_leave_profiles"),t.go("menu.newabsence",{leaveprofile:o},{reload:!0}),e.modal&&e.modal.hide()}}]).controller("AbsenceDetailsController",["$scope","$stateParams","SharedAbsenceService","$ionicPopup","$ionicHistory","ConfigService","EnvConfigService","$timeout","$ionicActionSheet",function(e,t,o,n,r,a,i,l,f){function c(t){l(function(){if(document.body.lastChild&&document.body.lastChild.firstChild){var e=window.getComputedStyle(document.body.lastChild.firstChild);"matrix(1, 0, 0, 1, 0, 0)"!=e["-webkit-transform"]&&(document.body.lastChild.firstChild.style["-webkit-transform"]="matrix(1, 0, 0, 1, 0, 0)")}},500),f.show({buttons:t,titleText:atrans("withdrawleave","Verlof intrekken"),cancelText:atrans("cancel","Annuleren"),cancel:function(){},buttonClicked:function(o){d.withdrawAbsence(e.absence.employee,e.absence.recordnumber,t[o].leaveProfile.Id).then(function(){r.goBack()})}})}var d=o.getAbsenceService();e.$on("$ionicView.enter",function(){var o=t.recordnumber,n=t.subjectid;a.getConfig().then(function(t){i.getEnvConfig().then(function(r){isNotEmpty(o)?(e.pageTitle=atrans("leavebooking","Verlofboeking"),d.getLeaveByRecordNumber(o).then(function(o){r.profileinfo[62]&&r.profileinfo[62]>0&&(e.mayWithdraw=isVersionOrHigher(t,"Profit15")&&!o.isWithdrawn),e.absence=o})):(e.pageTitle=atrans("avail_leaverequest","~avail~Verlof aanvraag"),e.canWithdraw=!1,d.getAbsenceBySubjectId(n).then(function(t){e.absence=t}))})})}),e.withdrawLeave=function(){n.confirm({title:atrans("confirmWithdrawLeave","Weet je zeker dat je deze verlofboeking wilt intrekken?"),subTitle:"",okText:atrans("Yes","Ja"),cancelText:atrans("No","Nee")}).then(function(t){t&&a.getConfig().then(function(t){isVersionOrHigher(t,"Profit15")&&i.getEnvConfig().then(function(t){t.profileinfo[62]>5?e.openModal():d.searchProfiles("",0,6,"withdraw").then(function(t){if(1===t.length)d.withdrawAbsence(e.absence.employee,e.absence.recordnumber,t[0].leaveProfile).then(function(){r.goBack()});else{for(var o=[],n=0;n<t.length;n++)o.push({text:"<i class='icon iconHide'></i>"+t[n].Description,id:2,leaveProfile:t[n]});c(o)}})})})})},e.openModal=function(){ModalSearchService.openModal(e,"Pocket_LeaveWithdrawProfiles",extraParam)},e.closeModal=function(){e.modal.hide()},e.showhide=function(){e.hidden=!e.hidden},e.search=function(t){ModalSearchService.search(e,t,extraParam)},e.loadMore=function(){ModalSearchService.loadMore(e,extraParam)},e.clearSearch=function(t){ModalSearchService.clearSearch(e)},e.clickRecent=function(t){e.modal.query=t,ModalSearchService.search(e,t,extraParam)},e.ShowRecentSearches=function(){ModalSearchService.ShowRecentSearches(e)},e.HideRecentSearches=function(){ModalSearchService.HideRecentSearches(e)},e.selectLeaveWithdrawType=function(t){SearchService.setRecentlySelected(t,"recent_leavewithdraw_profiles"),d.withdrawAbsence(e.absence.employee,e.absence.recordnumber,t.leaveProfile).then(function(){e.modal&&e.modal.hide(),r.goBack()})}}]).controller("NewAbsenceController",["$scope","$state","$stateParams","$ionicHistory","$ionicModal","$ionicPopup","$ionicScrollDelegate","$timeout","SharedAbsenceService","UserService","ConfigService","DatePickerService","EmployeeServiceFactory","ModalSearchService","SearchService","maxListTake","$ionicPosition",function(e,t,o,n,r,a,i,l,f,c,d,s,m,u,h,v,g){function y(t){var o;return e.multipledvb&&(o=e.form.dvbsel?e.form.dvbsel.employment:t.dvb),P.getSchedule(o).then(function(t){0==t[0].variable_work_pattern||1==t[0].variable_with_schedule?e.variableWorkPattern=!1:1==t[0].variable_work_pattern&&0==t[0].variable_with_schedule&&(e.variableWorkPattern=!0,e.form.allday=!1,e.leaveProfile&&(e.form.LeDt=!0),A=t[0].hours_per_week/t[0].days_per_week)})}function p(){return c.getUser().then(function(t){var o;return e.multipledvb&&(o=e.form.dvbsel?e.form.dvbsel.employment:t.dvb),P.getTimetable(getJSONDate(fromGMTDate(e.form.startdate),!0)+"T00H00",o).then(function(t){t.length>0?(S(t[0].start_time,t[t.length-1].end_time),M=new Date(e.form.enddate)):(e.form.enddate.setDate(e.form.startdate.getDate()),S("08:00","17:00"),M=new Date(e.form.enddate))})})}function b(){c.getUser().then(function(t){var o;e.form.type&&(o=e.form.type.id),e.leaveProfile&&e.form.ViAt?o=e.form.ViAt.idext||e.form.ViAt.id:e.maychoosetype||(o=e.defleavetypeid);var n;e.multipledvb&&(n=e.form.dvbsel?e.form.dvbsel.employment:t.dvb),P.PredictLeaveSaldoTime(t,getJSONDate(fromGMTDate(e.form.startdate),!0),getJSONDate(fromGMTDate(e.form.enddate),!0),getTimeString(fromGMTDate(e.form.startdate)),getTimeString(fromGMTDate(e.form.enddate)),o,n).then(function(t){if(T=t.SaldoBeforeMutation/60,e.variableWorkPattern&&fromGMTDate(e.form.startdate).equals(fromGMTDate(e.form.enddate))){var o=fromGMTDate(e.form.enddate).valueOf()-fromGMTDate(e.form.startdate).valueOf(),n=Math.floor(o/6e4);n<t.Duration&&n>=0&&(t.Duration=n,t.SaldoAfterMutation=60*T-n),t.Duration>0}e.form.amount=t.Duration>0?Math.round(t.Duration/60*100)/100:0,e.form.remaining=t.SaldoAfterMutation/60,e.loaded=!0})})}function w(t){return P.getTypes(getJSONDate(fromGMTDate(e.form.startdate)),getJSONDate(fromGMTDate(e.form.enddate)),e.user.workreg_id,e.user.cworkreg_id).then(function(o){e.types=[];for(var n=0;n<o.length;n++)1!=o[n].is_composite_leave&&e.types.push(o[n]),o[n].id==t&&(e.form.type=o[n]);return o})}function S(t,o){if(t){var n=fromGMTDate(e.form.startdate);n.setHours(t.split(":")[0]),n.setMinutes(t.split(":")[1]),e.form.startdate=getGMTDate(n)}if(o){var r=fromGMTDate(e.form.enddate);"00:00"===o&&(r=new Date(e.form.enddate),r.setDate(r.getDate()+1)),r.setHours(o.split(":")[0]),r.setMinutes(o.split(":")[1]),e.form.enddate=getGMTDate(r)}}function D(){return e.form.enddate.getFullYear()==M.getFullYear()&&e.form.enddate.getMonth()==M.getMonth()&&e.form.enddate.getDate()==M.getDate()?!0:!1}function k(){e.error=[];var t=!0;return 0==e.loaded&&(t=!1),(void 0==e.user||null==e.user)&&(t=!1),e.form.enddate<e.form.startdate&&(e.leaveProfile?(e.form.errorFld.DaEn=atrans("enddate_before_startdate","De einddatum mag niet voor begindatum liggen"),t=!1):(e.error[0]=atrans("enddate_before_startdate","De einddatum mag niet voor begindatum liggen"),t=!1)),e.maychoosetype&&(e.leaveProfile||void 0==e.form.type&&(e.error[2]=atrans("noleavetypespecified","Kies een verloftype"),t=!1)),e.variableWorkPattern&&(void 0==e.form.amount||e.form.amount<=0)&&(e.error[1]=atrans("no_hours_submitted","Er zijn geen uren ingevuld"),t=!1),t}var M,T,_,P=f.getAbsenceService(),I=m.getInstance(),A=0;e.loaded=!1,e.pageTitle=atrans("newabsence","Verlof aanvragen"),e.maychoosetype=!1,e.form={},e.form_modal={},e.form.amount=0,e.form.allday=!0,e.form.startdate=getGMTDate(new Date),e.form.enddate=getGMTDate(new Date),e.form.errorfld={},e.info=null,e.infoLoaded=!1,e.hiddenAvailability=!0,e.showavailability=!1,e.employeePlaceholder=atrans("choosereplacementemployee","Vul hier een medewerkerscode in"),e.availabilitybutton=atrans("showavailabilityonthisdate","Toon bezetting op deze datum"),M=e.form.enddate;var E={AbsenceService:P};e.setupFile=function(t){document.getElementById("fileBrowser").onchange=function(o){e.filePickedGeneric(o,t,e)}},e.$on("$ionicView.enter",function(){e.leaveProfile=t.params.leaveprofile,d.getConfig().then(function(t){c.getUser().then(function(o){e.user=o,e.availmode="1",e.multipleattach=isVersionOrHigher(t,"Profit14"),e.defleavetypeid=t.leavetypeid,e.maychoosetype=!!t.maychooseleavetype,-1!=t.modules.indexOf(10)&&(e.showavailability=!0),e.leaveProfile||y().then(function(){p()["finally"](function(){if(e.variableWorkPattern){var o=Math.ceil(Math.abs((e.form.startdate.getTime()-e.form.enddate.getTime())/864e5));e.form.amount=Math.round(A*o*100)/100}e.maychoosetype?e.leaveProfile||w(t.leavetypeid).then(function(){b()}):b()})}),P.getReasons().then(function(t){e.reasons=t}),e.leaveProfile?(e.info=null,e.form={},e.form.attachments=[],e.form.amount=0,e.form.startdate=getGMTDate(new Date),e.form.enddate=getGMTDate(new Date),e.form.errorfld={},P.getLeaveInfo(e.leaveProfile.Id).then(function(t){parseInfo(e,t,o,!1,"validateEntry2"),e.form.allday=!(e.info.LeDt&&e.info.LeDt.value),e.form.ProfileId={id:e.leaveProfile.Id},e.info.ProfileId={element:"HrAbsenceInSite"},o.paycloud_emp&&e.info.EmRp&&(e.info.EmRp.visible=!1),o.replacement&&e.validateEntry2(o.replacement,"EmRp")})["finally"](function(){e.infoLoaded=!0,y().then(function(){p()["finally"](function(){b()})})})):o.replacement&&e.validateEntry(o.replacement),e.multipledvb=o.multiple_employment&&isVersionOrHigher(t,"Profit6"),e.multipledvb&&P.getDvbs(e.form,!0).then(function(t){e.dvbs=t,e.multipledvbshow=t.length>1})})})}),e.showAvailPopup=function(){e.showAvailabilityPopup(e.availmode,e.form.startdate,e.form.enddate,e.user.employee_id)},e.calculateRemaining=function(){e.form.remaining=T-e.form.amount},e.pickStartDate=function(){c.getUser().then(function(t){var o,n;e.multipledvb&&(n=e.form.dvbsel?e.form.dvbsel.employment:t.dvb),s.pickDate(e.form.startdate).then(function(t){e.form.startdate=t,P.getTimetable(getJSONDate(fromGMTDate(e.form.startdate),!0)+"T00H00",n).then(function(n){n.length>0?(o=n[n.length-1].end_time,S(n[0].start_time,o)):(o="17:00",S("08:00",o)),(D()||e.form.enddate<e.form.startdate)&&(e.form.enddate=new Date(t),M=new Date(e.form.enddate),e.variableWorkPattern?S("08:00",o):S(null,o)),y().then(function(){b(),e.leaveProfile||w(e.form.type?e.form.type.id:"")})})})})},e.pickStartTime=function(){s.pickTime(e.form.startdate).then(function(t){var o=fromGMTDate(e.form.startdate);o.setHours(fromGMTDate(t).getHours(),fromGMTDate(t).getMinutes()),e.form.startdate=getGMTDate(o),b()})},e.pickEndDate=function(){c.getUser().then(function(t){var o;e.multipledvb&&(o=e.form.dvbsel?e.form.dvbsel.employment:t.dvb),s.pickDate(e.form.enddate).then(function(t){e.form.enddate=t,P.getTimetable(getJSONDate(fromGMTDate(e.form.enddate),!0)+"T00H00",o).then(function(t){t.length>0?(start_time=t[0].start_time,S(start_time,t[t.length-1].end_time)):(start_time="8:00",S(start_time,"17:00")),e.form.enddate<e.form.startdate&&(e.form.startdate=getGMTDate(e.form.enddate),S(start_time,null)),y().then(function(){b(),e.leaveProfile||w(e.form.type?e.form.type.id:"")})})})})},e.pickEndTime=function(){s.pickTime(e.form.enddate).then(function(t){var o=fromGMTDate(e.form.enddate);o.setHours(fromGMTDate(t).getHours(),fromGMTDate(t).getMinutes()),e.form.enddate=getGMTDate(o),b()})},e.changeType=function(e){b()},e.changeDvb=function(){c.getUser().then(function(t){e.multipledvb&&e.form.dvbsel&&SessionStorage.setItem("dvbsel",JSON.stringify(e.form.dvbsel)),b()})},e.checkBox=function(){1==e.form.allday&&y().then(function(){p()["finally"](function(){b()})})},e.selectEmployee=function(t){e.form.employee=t,h.setRecentlySelected(t,"recent_employees"),e.modal&&e.modal.hide()},e.openModalforField=function(t){if(E.fieldId=t,E.extraValue="",e.info[t])E.searchview=e.info[t].searchview,E.searchview.filter=e.info[t].filter,E.searchview.fromfieldId1?E.searchview.fieldValue2=formvalue(e.form[E.searchview.fromfieldId1],e.info[E.searchview.fromfieldId1]):e.form[E.searchview.fieldId2]&&(E.searchview.fieldValue2=formvalue(e.form[E.searchview.fieldId2],e.info[E.searchview.fieldId2])),E.searchview.fromfieldId2?E.searchview.fieldValue3=formvalue(e.form[E.searchview.fromfieldId2],e.info[E.searchview.fromfieldId2]):e.form[E.searchview.fieldId3]&&(E.searchview.fieldValue3=formvalue(e.form[E.searchview.fieldId3],e.info[E.searchview.fieldId3])),E.extraValue=getJSONDate(fromGMTDate(e.form.startdate))+";;"+getJSONDate(fromGMTDate(e.form.enddate));else for(var o in e.info.custom)if(e.info.custom.hasOwnProperty(o)&&e.info.custom[o][t]){E.searchview=e.info.custom[o][t].searchview;break}u.openModal(e,"Pocket_LeaveFields",E)},e.openModal=function(t){u.openModal(e,t)},e.closeModal=function(){e.modal.hide()},e.showhide=function(){e.hidden=!e.hidden},e.search=function(t){u.search(e,t,E)},e.loadMore=function(){u.loadMore(e,E)},e.clearSearch=function(t){u.clearSearch(e)},e.clickRecent=function(t){e.modal.query=t,u.search(e,t,E)},e.ShowRecentSearches=function(t){"Pocket_LeaveFields"==t?u.ShowRecentSearches(e,E):u.ShowRecentSearches(e)},e.HideRecentSearches=function(t){"Pocket_LeaveFields"==t?u.HideRecentSearches(e,E):u.HideRecentSearches(e)},e.selectTab=function(t){e.modal&&!e.modal.loading&&(e.modal.showType=t)},e.validateEntry2Delayed=function(t,o){_&&l.cancel(_),_=l(function(){_=null,e.validateEntry2(t,o)},800)},e.validateEntry2=function(t,o){if(e.form[o]=null,"string"!=typeof t&&(t=String(t)),t.length>0){if(e.form[o]={id:t},E.extraValue="",E.fieldId=o,e.info[o])E.searchview=e.info[o].searchview,E.searchview.filter=e.info[o].filter,E.searchview.fromfieldId1?E.searchview.fieldValue2=formvalue(e.form[E.searchview.fromfieldId1],e.info[E.searchview.fromfieldId1]):e.form[E.searchview.fieldId2]&&(E.searchview.fieldValue2=formvalue(e.form[E.searchview.fieldId2],e.info[E.searchview.fieldId2])),E.searchview.fromfieldId2?E.searchview.fieldValue3=formvalue(e.form[E.searchview.fromfieldId2],e.info[E.searchview.fromfieldId2]):e.form[E.searchview.fieldId3]&&(E.searchview.fieldValue3=formvalue(e.form[E.searchview.fieldId3],e.info[E.searchview.fieldId3])),E.extraValue=getJSONDate(fromGMTDate(e.form.startdate))+";;"+getJSONDate(fromGMTDate(e.form.enddate));else for(var n in e.info.custom)if(e.info.custom.hasOwnProperty(n)&&e.info.custom[n][o]){E.searchview=e.info.custom[n][o].searchview;break}E.onlyId=!0,P.searchForField(E,t,0,v).then(function(o){for(var n=o.rows,r=0;r<n.length;r++)if(n[r]._id==t)return void e.selectItem(n[r]);n&&n.length>0&&e.selectItem(n[0])})}},e.selectItem=function(t){e.form[t.fieldId]={id:t._id,name:t._name},e.form[t.fieldId+"_entry"]=t._id,h.setRecentlySelected(t,"recent_leave_"+t.fieldId),"ViAt"==t.fieldId&&b(),e.form.errorfld[t.fieldId]="",e.modal&&e.modal.hide()},e.validateEntry=function(t){_&&l.cancel(_),_=l(function(){e.form.employee=null,t.length>1&&(e.form.employee={employee_id:t},c.getUser().then(function(o){I.validateEntry(1,o.employee_id,t).then(function(t){e.selectEmployee(t)})})),_=null},800)},e.addAttachment=function(t){e.showFileActionsGeneric(t,e)},e.showAttachment=function(t){t?"img"==t.type&&e.showImage(t.src):e.file_attached&&"img"==e.attachment_type&&e.showImage(document.getElementById("declaration_attachment").src)},e.deleteAttachment=function(t){if(t){if(""!=t.src&&e.file_attached){var o=e.form.attachments.indexOf(t);-1!=o&&e.form.attachments.splice(o,1)}}else""!=document.getElementById("declaration_attachment").src&&e.file_attached&&confirm(atrans("deletedeclarationphoto","Wil je deze foto verwijderen?"))&&(e.file_attached=!1,e.form.fileURI=void 0,document.getElementById("fileBrowser").form.reset(),document.getElementById("declaration_attachment").src="")},e.newAbsence=function(){if(k())if(e.leaveProfile)c.getUser().then(function(t){e.form.LeDt=!e.form.allday,e.multipledvb&&e.form.dvbsel&&(e.form.EnSe={id:e.form.dvbsel.employment});var o=!1;e.form.errorfld={};for(key in e.info)e.info.hasOwnProperty(key)&&"FiId"!=key&&"DateBegin"!=key&&"DateEnd"!=key&&"TimeBegin"!=key&&"TimeBegin"!=key&&"Dura"!=key&&(o|=checkFormField(e.form,e.info,key,t));for(ckey in e.info.custom)if(e.info.custom.hasOwnProperty(ckey))for(key in e.info.custom[ckey])e.info.custom[ckey].hasOwnProperty(key)&&(o|=checkFormField(e.form,e.info.custom[ckey],key,t));if(e.info.FiId&&e.info.FiId.mandatory&&0==e.form.attachments.length&&(e.error[2]=atrans("noattachmentadded","Voeg een bijlage toe"),l(function(){var e=document.getElementById("errorfile");if(null!=e){var t=g.position(angular.element(e));i.$getByHandle("main").scrollTo(0,t.top,!1)}},10),o=!0),o)showErrors(e.form,e.info,"main",l,a,g,i);else{var r;e.form.ViLr&&(r=e.form.ViLr.idext||e.form.ViLr.id);var f={EmId:e.user.code,DuRa:e.form.amount,ViAt:e.form.ViAt.idext||e.form.ViAt.id,ViLr:r,DaBe:getJSONDate(fromGMTDate(e.form.startdate)),DaEn:getJSONDate(fromGMTDate(e.form.enddate)),LeDt:e.form.LeDt,Re:e.form.Re};if(e.form.EmRp&&(f.EmRp=e.form.EmRp.id),e.form.dvbsel&&(f.EnSe=e.form.dvbsel.employment),e.info.custom)for(ckey in e.info.custom)if(e.info.custom.hasOwnProperty(ckey))for(key in e.info.custom[ckey])"object"==typeof e.form[key]&&e.form[key]&&e.form[key].id?f[key]=e.form[key].idext?e.form[key].idext:e.form[key].id:"object"==typeof e.form[key]&&e.form[key]&&e.form[key].getDate?f[key]=getJSONDate(fromGMTDate(e.form[key])):12==e.info.custom[ckey][key].dtype&&e.form[key]?f[key]=e.form[key].toString().replace(",","."):isUpdatable(e.form,e.info.custom[ckey],key)&&(f[key]=e.form[key]);e.variableWorkPattern?P.postAbsence(f,!0,e.leaveProfile.Id,e.form.attachments).then(function(e){n.goBack()}):P.postAbsence(f,!1,e.leaveProfile.Id,e.form.attachments).then(function(e){n.goBack()})}});else{var t;void 0!=e.form.reason&&(t=e.form.reason.id),d.getConfig().then(function(o){var r={EmId:e.user.code,DuRa:e.form.amount,ViAt:e.maychoosetype?e.form.type.id:o.leavetypeid,ViLr:t,DaBe:getJSONDate(fromGMTDate(e.form.startdate)),DaEn:getJSONDate(fromGMTDate(e.form.enddate)),LeDt:!e.form.allday,Re:""};"undefined"!=typeof e.form.employee&&null!=e.form.employee&&(r.EmRp=e.form.employee.employee_id),e.form.dvbsel&&(r.EnSe=e.form.dvbsel.employment),e.variableWorkPattern?P.postAbsence(r,!0).then(function(e){n.goBack()}):P.postAbsence(r,!1).then(function(e){n.goBack()})})}}}]);