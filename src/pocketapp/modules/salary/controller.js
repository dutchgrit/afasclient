angular.module("salary.controller",["AfasServices"]).controller("SalaryController",["$scope","$window","$timeout","ListServiceFactory","LongOperationService","SalaryServiceFactory","ConnectorService","ConfigService","SubjectServiceFactory","$ionicActionSheet","$ionicTabsDelegate","$ionicScrollDelegate",function(e,n,t,a,i,o,r,l,s,c,d,f){function p(n){var a=new Array;a.push({text:0==e.tabs[e.slider.activeIndex].mode?"<i class='icon iconHide'></i>"+atrans("downloadpayslip","Download loonstrook")+"</span>":"<i class='icon iconHide'></i>"+atrans("downloadannualstatement","Download jaaropgave")+"</span>"}),a.push({text:0==e.tabs[e.slider.activeIndex].mode?"<i class='icon iconHide'></i>"+atrans("showpayslip","Toon loonstrook")+"</span>":"<i class='icon iconHide'></i>"+atrans("showannualstatement","Toon jaaropgave")+"</span>"}),t(function(){if(document.body.lastChild&&document.body.lastChild.firstChild){var e=window.getComputedStyle(document.body.lastChild.firstChild);"matrix(1, 0, 0, 1, 0, 0)"!=e["-webkit-transform"]&&(document.body.lastChild.firstChild.style["-webkit-transform"]="matrix(1, 0, 0, 1, 0, 0)")}},500),c.show({buttons:a,titleText:0==e.tabs[e.slider.activeIndex].mode?atrans("opensalary","Open loonstrook"):atrans("openannualstatement","Open jaaropgave"),cancelText:atrans("cancel","Annuleren"),cancel:function(){},buttonClicked:function(t){return 0==t?r.downloadFile(n,"attachment_id","attachment_filename",null,null,n.alternative_filename):1==t&&e.openDoc(!1,{fileguid:n.attachment_id,filename:n.attachment_filename}),!0}})}function u(e){e=e.toString();var n,t=e.split("-");if("PS"===t[0]){n=u(t);var a=parseInt(t[1]);if(t[3].includes("/"))var i=t[3].split("/"),o=parseInt(i[0]),r=parseInt(i[1]);else var o=parseInt(t[3]);n=atrans("payslip","Loonstrook")+" "+atrans("period","Periode")+" "+o,r&&(n+="("+r+")"),n+=" ("+a+")"}else if("YS"===t[0]){var a=parseInt(t[1]);n=atrans("annualstatement","Jaaropgave")+" "+a}return n+".pdf"}var m=s.getInstance(),g=o.getInstance();a.getInstance();e.pageTitle=atrans("payslips","Loonstroken"),e.hasProforma=!1,e.tabs=[{name_id:"tabLoonstroken",mode:0,title:atrans("payslips","Loonstroken")},{name_id:"tabJaaropgaves",mode:1,title:atrans("annualstatements","Jaaropgaves")}],l.getConfig().then(function(n){if(isVersionOrHigher(n,"Profit10")){var t=n.modules;-1!=t.indexOf(17)&&(e.hasProforma=!0)}}),e.showProforma=function(){e.gotoPage("menu.proforma")},e.downloadAttachment=function(e){l.getConfig().then(function(n){isVersionOrHigher(n,"Profit7")?(i.startBlock(),m.getAttachments({guid:e.subject_id}).then(function(n){var t;n&&n.length>0&&(e.reference?(t=u(e.reference),p({attachment_id:n[0].file_id,attachment_filename:n[0].file_name,alternative_filename:t})):p({attachment_id:n[0].file_id,attachment_filename:n[0].file_name,alternative_filename:null}))})["finally"](function(){i.endBlock()})):p(e)})},e.$on("$ionicView.beforeEnter",function(){g.getPayslips().then(function(n){e.tabs[0].payslips=n.filter(function(e){return-2==e.subject_type}),e.tabs[1].payslips=n.filter(function(e){return-3==e.subject_type})})}),e.$on("$ionicView.unloaded",function(){e.slider=void 0}),e.$on("$ionicSlides.sliderInitialized",function(n,t){e.slider=t.slider,d.$getByHandle("tabssalary").select(0),e.slider.lockSwipes()}),e.$on("$ionicSlides.slideChangeStart",function(e,n){t(function(){d.$getByHandle("tabssalary").select(n.slider.activeIndex)},1)}),e.selectSalaryTab=function(n){e.slider&&e.slider.activeIndex!=n&&(e.slider.unlockSwipes(),e.slider.slideTo(n),e.slider.lockSwipes(),e.pageTitle=e.tabs[e.slider.activeIndex].title)},e.scrollTop=function(){f.$getByHandle("payslips").scrollTop(!0)}}]).controller("ProformaController",["$scope","SalaryServiceFactory",function(e,n){var t=n.getInstance();e.pageTitle=atrans("proformapayslip","Proforma loonstrook"),e.$on("$ionicView.beforeEnter",function(){t.getProforma().then(function(n){e.proforma=n})})}]);