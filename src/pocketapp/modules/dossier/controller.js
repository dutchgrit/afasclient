angular.module("dossier.controller",["AfasServices"]).controller("DossierController",["$scope","$state","$window","$timeout","$ionicScrollDelegate","$ionicTabsDelegate","ConnectorService","DossierServiceFactory","MultipleViewsManager","UserService","ConfigService","SearchService","maxListTake","ListServiceFactory","ModalFilterService",function(e,r,o,i,s,a,t,d,n,l,c,h,f,u,m){function S(){e.loading=!0,e.searched=!1,e.dossieritems=[],y(),g.getDossier(0,f,e.orderBy,e.orderByDir,e.query,e.searchField).then(function(r){e.fields=r.fields;for(var o=0;o<r.deffields.length;o++)e.fields.push(r.deffields[o]);e.showmore=r.rows.length%f==0,e.orderByHeader&&e.orderBy&&(r.rows=D.handleHeaders(r.rows,e.orderBy)),r.rows.length>0?e.dossieritems=r.rows:e.dossieritems=[],e.loaded=r.rows.length,e.searched=!0,e.$broadcast("scroll.refreshComplete")})["finally"](function(){e.loading=!1})}function y(){e.orderBy=JSON.parse(LocalStorage.getItem("DossierSortfield"))||null,e.orderByHeader=e.orderBy?D.controlDataTypeAllowsHeader(e.orderBy.ctype,e.orderBy.dtype):!1,e.orderByDir=parseInt(LocalStorage.getItem("DossierSortdir")||"1",10),e.orderByDirName=0==e.orderByDir?"Z-A":"A-Z"}var g=d.getInstance(),D=u.getInstance(),p="Dossier";e.pageTitle=atrans("mydossier","Mijn dossier"),e.refreshText=atrans("refreshtext","Laat los om te verversen"),e.loadingMore=!1,e.title=atrans("mydossier","Mijn dossier"),e.searchPlaceholder=atrans("dossierplaceholder","Zoek op dossier"),e.formData=[],e.formData.query="",e.fromdossier=!0,e.dossieritems=[],e.loading=!1,e.searched=!1,e.query=null,e.searchField=JSON.parse(LocalStorage.getItem("DossierSearchField"))||null;var B=LocalStorage.getItem("DossierSearchFieldName");e.searchPlaceholder=B?atrans("searchgen","Zoek op {0}",B):e.searchplaceholder,y(),e.$on("$ionicView.beforeEnter",function(){e.landscape=e.isLandscape(),c.getConfig().then(function(r){-1==r.modules.indexOf(23)?e.gotoPage("menu.home"):e.slider&&i(function(){e.slider&&e.slider.onResize(!0)},400)})}),e.$on("$ionicView.unloaded",function(){e.slider=void 0}),e.show=function(r){e.slider&&e.slider.activeIndex!=r&&e.slider.slideTo(r)},S(),e.loadMoreDossieritems=function(){if(!e.loading){e.loading=!0;e.orderBy?e.orderBy.id:null;g.getDossier(e.loaded,f,e.orderBy,e.orderByDir,e.query,e.searchField).then(function(r){e.showmore=e.dossieritems.length<r.rows.length,e.loaded=r.rows.length,e.dossieritems=r.rows,e.orderByHeader&&(e.dossieritems=D.handleHeaders(e.dossieritems,e.orderBy,e.dossieritems[e.dossieritems.length-1])),e.$broadcast("scroll.infiniteScrollComplete")})["finally"](function(){e.loading=!1,s.$getByHandle("dossier").resize(),e.$broadcast("scroll.refreshComplete")})}},e.refresh=function(){S()},e.goToDossieritem=function(o){n.isActive()?(e.selectedGuid=o,n.updateView("tasks-detail",{subjectId:o})):r.go("menu.subject",{subjectId:o})},e.$on("$ionicSlides.sliderInitialized",function(r,o){e.slider=o.slider}),e.$on("$ionicSlides.slideChangeStart",function(e,r){i(function(){a.$getByHandle("tabsdossier").select(r.slider.activeIndex)},1)}),e.selectDossierTab=function(r){e.slider&&e.slider.activeIndex!=r&&(e.slider.unlockSwipes(),e.slider.slideTo(r),e.slider.lockSwipes(),e.tabs[r].searched||e.refresh(r))},e.searchDossieritem=function(){var r=e.query;0==r.length?e.clearSearchDossier():(h.setSearchHistory(r,p),s.$getByHandle("dossier").scrollTop(!0),S(),hideKeyboard(),e.HideRecentDossierSearches())},e.ShowRecentDossierSearches=function(){h.getSearchHistory(p).then(function(r){e.recent=r})},e.HideRecentDossierSearches=function(){i(function(){e.recent=0},100)},e.clickRecentDossieritem=function(r){e.query=r,e.searchDossieritem(r)},e.removeItemDossier=function(e,r){e.preventDefault(),e.stopPropagation(),h.removeItem(r,p)},e.clearSearchDossier=function(){e.query="",e.HideRecentDossierSearches(),e.dossieritems=null,e.loaded=0,e.refresh()},e.openModalQuery=function(r){var o=e.orderBy?e.orderBy.id:null;m.openModal(e,e.fields,e.orderByDir,e.searchField,o)},e.selectModalTab=function(r){e.modal&&(e.modal.showType=r)},e.selectModalSearchField=function(r){LocalStorage.setItem("DossierSearchField",JSON.stringify(r)),LocalStorage.setItem("DossierSearchFieldName",r.name),e.searchField=r,e.searchPlaceholder=atrans("searchgen","Zoek op {0}",r.name),e.modal&&i(function(){e.modal.hide()},200)},e.selectModalSortField=function(r){LocalStorage.setItem("DossierSortfield",JSON.stringify(r)),e.orderBy=r,e.orderByHeader=D.controlDataTypeAllowsHeader(r.ctype,r.dtype),e.modal&&i(function(){e.modal.hide()},200),S()},e.pickdir=function(r){e.modal.sortDir=r,LocalStorage.setItem("DossierSortdir",r),e.orderByDir=r,e.orderByDirName=0==r?"Z-A":"A-Z",e.orderBy&&e.modal&&(i(function(){e.modal.hide()},200),S())},e.reverseSortDirection=function(){var r=0==e.orderByDir?1:0;LocalStorage.setItem("DossierSortdir",r),e.orderByDir=r,e.orderByDirName=0==r?"Z-A":"A-Z",S(),s.$getByHandle("dossier").scrollTop(!0)},e.search=function(r){ModalSearchService.search(e,r,extraParam)},e.selectTab=function(r){e.modal&&!e.modal.loading&&(e.modal.showType=r)},e.loadMore=function(){ModalSearchService.loadMore(e,extraParam)},e.clearSearch=function(r){ModalSearchService.clearSearch(e)},e.clickRecent=function(r){e.modal.query=r,ModalSearchService.search(e,r,extraParam)},e.ShowRecentSearches=function(){ModalSearchService.ShowRecentSearches(e)},e.HideRecentSearches=function(){ModalSearchService.HideRecentSearches(e)},e.closeModal=function(){e.modal.hide()},e.showhide=function(){e.hidden=!e.hidden}}]);